<!DOCTYPE html>
<html lang="en">

<head>
    <title>Getting Started</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Project documentation.">
    <meta name="author" content="Yupiik Minisite Generator">
    <meta name="generator" content="Yupiik Minisite Generator">
    
    <link rel="shortcut icon" href="//www.yupiik.com/img/favicon.png">

    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Montserrat:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.5-5/css/asciidoctor.min.css" integrity="sha512-kI7tn5cuEg16kMeXnYmg8rEJPxbxzEM7Gsr191iQdLDevFBLXPCSU9aZWSVuP61tMZWU3nBAR1cJ7SmXnOGLZw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/vs2015.min.css" integrity="sha512-w8aclkBlN3Ha08SMwFKXFJqhSUx2qlvTBFLLelF8sm4xQnlg64qmGB/A6pBIKy0W8Bo51yDMDtQiPLNRq1WMcQ==" crossorigin="anonymous" />
    <link id="theme-style" rel="stylesheet" href="https://www.yupiik.io/kubernetes-java-descriptors/css/theme.css?v=1.0-SNAPSHOT">
    
</head>
<body>
    <header class="header fixed-top">
        <div class="branding docs-branding">
            <div class="container-fluid position-relative py-2">
                <div class="docs-logo-wrapper">
	                <div class="site-logo"><a title="Home" class="navbar-brand" href="https://www.yupiik.io/kubernetes-java-descriptors/index.html">
	                <img class="logo-icon mr-2" src="//www.yupiik.com/img/favicon.png" alt="logo">
	                <span class="logo-text">Kubernetes Java Descriptors <span class="text-alt">Docs</span></span></a></div>
                </div>
	            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
					
					<li class="list-inline-item"><a title="Search" id="search-button" href="#" data-toggle="modal" data-target="#searchModal"><i data-toggle="tooltip" data-placement="top" title="Search" class="fas fa-search"></i></a></li>

					<ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
						
						<li class="list-inline-item"><a href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
		            </ul>
	            </div>
            </div>
        </div>
    </header>
	<div class="page">
        <div class="page-navigation-left">
            <h3>Menu</h3>
            <ul>
                <li>
                    <a title="Getting Started" href="https://www.yupiik.io/kubernetes-java-descriptors/getting-started.html">
                        <i class="fas fa-play"></i>Getting Started
                    </a>
                </li>                <li>
                    <a title="Kubernetes Java Bindings" href="https://www.yupiik.io/kubernetes-java-descriptors/kubernetes-java-bindings.html">
                        <i class="fas fa-cloud"></i>Kubernetes Java Bindings
                    </a>
                </li>                <li>
                    <a title="Bundlebee Integration" href="https://www.yupiik.io/kubernetes-java-descriptors/bundlebee-integration.html">
                        <i class="fas fa-box"></i>Bundlebee Integration
                    </a>
                </li>                <li>
                    <a title="CI Setup" href="https://www.yupiik.io/kubernetes-java-descriptors/ci-setup.html">
                        <i class="fas fa-industry"></i>CI Setup
                    </a>
                </li>
            </ul>
        </div>

        <div id="getting-started-html-container" class="container page-content getting-started-html">
                        <div class="page-header">
                <h1>Getting Started</h1>
            </div>
            <div class="page-content-body">
                <div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This project aims at providing code models for <em>Java</em> applications.
It is primarily intended for CI/CD pipelines to automate the descriptor generation and integrate with company rules.
It guarantees your descriptors respect the Kubernetes schema your Kubernetes cluster supports (thanks its versioning).
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_features">Key features</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Versionned Kubernetes API (so you can change of cluster easily and identify the breaking change if any),</p>
</li>
<li>
<p>Typed API (so less typo error),</p>
</li>
<li>
<p>Java based (so well known and tooled in the industry),</p>
</li>
<li>
<p>Java based bis (so easily industrializable - you can create reusable libraries to help you to avoid to write the boilerplate),</p>
</li>
<li>
<p>DSL provided: easy to write code generating descriptors,</p>
</li>
<li>
<p>JSON-P friendly (so it is easy to reuse JSON features like formatting, JSON-Patch etc&#8230;&#8203;),</p>
</li>
<li>
<p>JSON-B friendly (so you can bind descriptors you would load yourself or already generated quite easily),</p>
</li>
<li>
<p>Light (By default the modules are dependency free until you generate a descriptor needing JSON-P which is the only required library at <em>runtime</em>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>High level, the project provides you dependencies/libraries with enable you to use a DSL to create descriptors.</p>
</div>
<div class="paragraph">
<p>If we want to create the descriptor corresponding to this YAML (sample taken from Kubernetes documentation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can write this snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final var deploymentJson = new Deployment()
        .metadata(new ObjectMeta()
                .name("nginx-deployment")
                .labels(Map.of("app", "nginx")))
        .spec(new DeploymentSpec()
                .replicas(3)
                .selector(new LabelSelector()
                        .matchLabels(Map.of("app", "nginx")))
                .template(new PodTemplateSpec()
                        .metadata(new ObjectMeta()
                                .labels(Map.of("app", "nginx")))
                        .spec(new PodSpec()
                                .containers(List.of(new Container()
                                        .name("nginx")
                                        .image("nginx:1.14.2")
                                        .ports(List.of(new ContainerPort()
                                                .containerPort(80))))))))
        .validate()
        .asJson();
System.out.println(deploymentJson);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output is not formatted but you can use JSON-P to format it quite easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// these instances are reusable and you should reuse them
// (for mem optimization when using this method for multiple descriptors)
final var readerFactory = Json.createReaderFactory(Map.of());
final var writerFactory = Json.createWriterFactory(Map.of(JsonGenerator.PRETTY_PRINTING, true));

// format():
final var out = new StringWriter();
try (final var reader  = readerFactory.createReader(new StringReader(deploymentJson));
     final var writer = writerFactory.createWriter(out)) {
    writer.write(reader.readValue());
}
System.out.println(out);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will output this descriptor (keep in mind JSON is a valid YAML descriptor):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "apiVersion":"apps/v1",
  "kind":"Deployment",
  "metadata":{
    "labels":{
      "app":"nginx"
    },
    "name":"nginx-deployment"
  },
  "spec":{
    "replicas":3,
    "selector":{
      "matchLabels":{
        "app":"nginx"
      }
    },
    "template":{
      "metadata":{
        "labels":{
          "app":"nginx"
        }
      },
      "spec":{
        "containers":[
          {
            "image":"nginx:1.14.2",
            "name":"nginx",
            "ports":[
              {
                "containerPort":80
              }
            ]
          }
        ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For now we didn&#8217;t do much better than what we would have done manually but now, if we rewrite our base generation we can see why coding its descriptors is interesting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// <b class="conum">(1)</b>
final var name = "nginx";
final var labels = Map.of("app", name);

<b class="conum">(2)</b>
final var deploymentJson = new Deployment()
        .metadata(new ObjectMeta()
                .name(name + "-deployment")
                .labels(labels))
        .spec(new DeploymentSpec()
                .replicas(3)
                .selector(new LabelSelector()
                        .matchLabels(labels))
                .template(new PodTemplateSpec()
                        .metadata(new ObjectMeta()
                                .labels(labels))
                        .spec(new PodSpec()
                                .containers(List.of(new Container()
                                        .name(name)
                                        .image("nginx:1.14.2")
                                        .ports(List.of(new ContainerPort()
                                                .containerPort(80))))))))
        .validate()
        .asJson();</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We can extract variables reused accross the descriptor without copy/paste or search/replace operation which are error prone,</p>
</li>
<li>
<p>We just inject variables instead of values.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Until there you can reach this same goal with Yupiik Bundlebee or Helm since it is mainly using placeholders but what if you could use your own easy to write functions?
This is exactly what makes it very powerful and enterprise friendly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// <b class="conum">(1)</b>
private Deployment enforceOpsStandards(final Deployment spec,
                                       final Map&lt;String, String&gt; labels,
                                       final JsonBuilderFactory jsonBuilderFactory) {
    final var template = spec.getSpec().getTemplate();

    // <b class="conum">(2)</b>
    if (spec.getMetadata().getLabels() != null &amp;&amp;
            !spec.getMetadata().getLabels().isEmpty()) {
        if (template.getMetadata() == null) {
            template.setMetadata(new ObjectMeta());
        }
        if (template.getMetadata().getLabels() == null) {
            template.getMetadata().labels(spec.getMetadata().getLabels());
        } else { // merge and don't override pod with deployment label if already there
            spec.getMetadata().getLabels().forEach(spec.getMetadata().getLabels()::putIfAbsent);
        }
    }

    // <b class="conum">(3)</b>
    template.getSpec().getContainers().stream()
            .filter(c -&gt; c.getResources() == null || c.getResources().getLimits() == null)
            .forEach(c -&gt; c.resources(new ResourceRequirements()
                    .requests(jsonBuilderFactory.createObjectBuilder()
                            .add("memory", "64Mi")
                            .add("cpu", "250m")
                            .build())
                    .limits(jsonBuilderFactory.createObjectBuilder()
                            .add("memory", "64Mi")
                            .add("cpu", "250m")
                            .build())));
    return spec;
}

// <b class="conum">(4)</b>
final var jsonBuilderFactory = Json.createBuilderFactory(Map.of()); // optional, depends enforceOpsStandards()
final var deployment = createDeployment();
final var json = enforceOpsStandards(deployment, labels, jsonBuilderFactory) // <b class="conum">(5)</b>
                .validate()
                .asJson();</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We create a reusable function in our preferred language (or "well known" at least),</p>
</li>
<li>
<p>This function enforces pods to inherit from deployment labels,</p>
</li>
<li>
<p>And also containers to have limits for resources.</p>
</li>
<li>
<p>The usage is pretty straight forward since it is just calling a java function from java code.</p>
</li>
<li>
<p>Extracted like that, all the project/ops/architects rules can easily be enforced and validated at build/CI time.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
if you set properly the classpath this is compatible with JShell but a <code>mvn exec:java</code> setup also works very smoothly.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_go_further_with_bundlebee">Go further with BundleBee</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.yupiik.io/bundlebee">Yupiik BundleBee</a> is a Kubernetes package manager to ease your deployment on your Kubernetes clusters (from minikube to production clusters).
It is also based on descriptors and the module <code>bundlebee-java</code> provides you an enriched DSL to generate them easily and integrated with any version of <code>kubernetes-java</code> descriptors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// <b class="conum">(1)</b>
final var deployment = new Deployment()
        .metadata(new ObjectMeta()
                .name("demo-deployment"))
        .spec(new DeploymentSpec()
            .replicas(1)
            .selector(new LabelSelector()
                .matchLabels(Map.of("app", "demo")))
            .template(new PodTemplateSpec()
                .spec(new PodSpec()
                    .containers(List.of(new Container()
                        .name(name)
                        .image("nginx:1.14.2")
                        .ports(List.of(new ContainerPort()
                            .containerPort(80))))))))
        .validate();

<b class="conum">(2)</b>
new Manifest()
    .alveoli(List.of(
        new Alveolus() <b class="conum">(3)</b>
            .name("my-deployment")
            .descriptors(List.of(
                new Descriptor()
                    .name("deployment.yaml")
                    .interpolate(true)
                    .underlyingDescriptor(myDeployment) <b class="conum">(4)</b>
                    .validate()))
            .validate()))
    .validate()
    .writeTo(Path.of("target/bundlebee_dump")); <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a deployment - or more generally a Kubernetes descriptor - with the technique seen in previous part but don&#8217;t serialize it yet,</p>
</li>
<li>
<p>Create a manifest (BundleBee entry point),</p>
</li>
<li>
<p>Create an alveolus (a library/application recipe in BundleBee semantic),</p>
</li>
<li>
<p>Bind the descriptor you created to the reference BundleBee uses,</p>
</li>
<li>
<p>Finally dump the manifest in a folder. This will create the correct BundleBee layout and if the <code>underlyingDescriptor</code> instance is attached and an <code>Exportable</code> of the <code>kubernetes-java-$version</code> module you use, then it will dump the descriptor as well in a single step!</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
don&#8217;t hesitate to create functions to instantiate the <code>Descriptor</code> using conventions to enforce the consistency in your deployment code.
A typical case is to ame the descriptor from its underlying descriptor (reusing metadata name for example).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_choose_your_version">Choose your version</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To ensure you target the right descriptor for your cluster, it is recommended to use as dependency the module you target.
Typically, if you target Kubernetes 1.24.3, you will use the module <code>kubernetes-java-1.24.3</code>.</p>
</div>
<div class="paragraph">
<p>You can check on the <a href="kubernetes-java-bindings.html">binding list</a> page the one you need.</p>
</div>
</div>
</div>
                
            </div>
        </div>
    <div class="page-navigation-right">
        <h3>Navigation</h3>
        <nav class="generated-nav-menu"></nav>
    </div>
    </div>
    <hr />
    <footer class="footer pb-5">
	    <div class="footer-bottom text-center">
		    <ul class="social-list list-unstyled">
                <li class="list-inline-item"><a href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
	        </ul>
            <small class="copyright">Yupiik &copy;</small> | <a href="https://www.yupiik.com/terms-of-service/">Terms of service</a> | <a href="https://www.yupiik.com/privacy-policy/">Privacy policy</a>
	    </div>
    </footer>

    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">Search</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form onsubmit="return false;" class="form-inline">
          <div class="form-group">
            <label for="searchInput"><b>Search: </b></label>
            <input class="form-control" id="searchInput" placeholder="Enter search text and hit enter...">
          </div>
        </form>
        <div class="search-hits"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js" integrity="sha512-8qmis31OQi6hIRgvkht0s6mCOittjMa9GMqtK9hes5iEQBQE/Ca6yGE5FsW36vyipGoWQswBj/QBm2JR086Rkw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/highlight.min.js" integrity="sha512-d00ajEME7cZhepRqSIVsQVGDJBdZlfHyQLNC6tZXYKTG7iwcF8nhlFuppanz8hYgXr8VvlfKh4gLC25ud3c90A==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/json.min.js" integrity="sha512-37sW1XqaJmseHAGNg4N4Y01u6g2do6LZL8tsziiL5CMXGy04Th65OXROw2jeDeXLo5+4Fsx7pmhEJJw77htBFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/dockerfile.min.js" integrity="sha512-eRNl3ty7GOJPBN53nxLgtSSj2rkYj5/W0Vg0MFQBw8xAoILeT6byOogENHHCRRvHil4pKQ/HbgeJ5DOwQK3SJA==" crossorigin="anonymous"></script>
    <script>if (!(window.minisite || {}).skipHighlightJs) { hljs.highlightAll(); }</script>
    <script src="https://www.yupiik.io/kubernetes-java-descriptors/js/minisite.js?v=1.0-SNAPSHOT"></script>
    <script>$('.page-content-body').generatedNavMenu();</script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.3/fuse.min.js" integrity="sha512-neoBxVNv0UMXjoilAYGxfWrSsW6iAVclx7vQKdPJ9Peet1bM5YQjU0aIB8LtH8iNPa+pAyMZprBBw2ZQ/Q1LjQ==" crossorigin="anonymous"></script>

</body>
</html>
