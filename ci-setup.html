<!DOCTYPE html>
<html lang="en">

<head>
    <title>CI Setup</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Project documentation.">
    <meta name="author" content="Yupiik Minisite Generator">
    <meta name="generator" content="Yupiik Minisite Generator">
    
    <link rel="shortcut icon" href="//www.yupiik.com/img/favicon.png">

    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Montserrat:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.5-5/css/asciidoctor.min.css" integrity="sha512-kI7tn5cuEg16kMeXnYmg8rEJPxbxzEM7Gsr191iQdLDevFBLXPCSU9aZWSVuP61tMZWU3nBAR1cJ7SmXnOGLZw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/vs2015.min.css" integrity="sha512-w8aclkBlN3Ha08SMwFKXFJqhSUx2qlvTBFLLelF8sm4xQnlg64qmGB/A6pBIKy0W8Bo51yDMDtQiPLNRq1WMcQ==" crossorigin="anonymous" />
    <link id="theme-style" rel="stylesheet" href="http://localhost:4200/css/theme.css?v=1.0-SNAPSHOT">
    
</head>
<body>
    <header class="header fixed-top">
        <div class="branding docs-branding">
            <div class="container-fluid position-relative py-2">
                <div class="docs-logo-wrapper">
	                <div class="site-logo"><a title="Home" class="navbar-brand" href="http://localhost:4200/index.html">
	                <img class="logo-icon mr-2" src="//www.yupiik.com/img/favicon.png" alt="logo">
	                <span class="logo-text">Kubernetes Java Descriptors <span class="text-alt">Docs</span></span></a></div>
                </div>
	            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
					
					<li class="list-inline-item"><a title="Search" id="search-button" href="#" data-toggle="modal" data-target="#searchModal"><i data-toggle="tooltip" data-placement="top" title="Search" class="fas fa-search"></i></a></li>

					<ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
						
						<li class="list-inline-item"><a href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
		            </ul>
	            </div>
            </div>
        </div>
    </header>
	<div class="page">
        <div class="page-navigation-left">
            <h3>Menu</h3>
            <ul>
                <li>
                    <a title="Getting Started" href="http://localhost:4200/getting-started.html">
                        <i class="fas fa-play"></i>Getting Started
                    </a>
                </li>                <li>
                    <a title="Kubernetes Java Bindings" href="http://localhost:4200/kubernetes-java-bindings.html">
                        <i class="fas fa-cloud"></i>Kubernetes Java Bindings
                    </a>
                </li>                <li>
                    <a title="Bundlebee Integration" href="http://localhost:4200/bundlebee-integration.html">
                        <i class="fas fa-box"></i>Bundlebee Integration
                    </a>
                </li>                <li>
                    <a title="CI Setup" href="http://localhost:4200/ci-setup.html">
                        <i class="fas fa-industry"></i>CI Setup
                    </a>
                </li>
            </ul>
        </div>

        <div id="ci-setup-html-container" class="container page-content ci-setup-html">
                        <div class="page-header">
                <h1>CI Setup</h1>
            </div>
            <div class="page-content-body">
                <div class="sect1">
<h2 id="_maven_setup">Maven setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maven setup is likely the easiest, what you have to do is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a descriptor generation module,</p>
</li>
<li>
<p>Add the needed dependencies in this pom module (see <a href="kubernetes-java-bindings.html">bindings</a> page if needed),</p>
</li>
<li>
<p>Write a main with the generation,</p>
</li>
<li>
<p>Use <code>exec-maven-plugin</code> to run your main.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is a skeleton:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyGenerator {
    public static void main(final String... args){
        final var output = Files.createDirectories(Path.of(args[0])); <b class="conum">(1)</b>

        final var deployment = new Deployment() <b class="conum">(2)</b>
                    .spec(new DeploymentSpec()
                    // ... complete the generation as needed
        );

        Files.writeString( <b class="conum">(3)</b>
                output.resolve("my-deployment.json"),
                deployment.asJson());
    }

    private MyGenerator() {
        // no-op
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Get and create the output directory for this run (generally in <code>target/</code>/<code>${project.build.directory}</code>),</p>
</li>
<li>
<p>Create your in memory descriptor,</p>
</li>
<li>
<p>Write your descriptor on the disk (or in a zip directly if you prefer).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now to execute this main you can just use this <code>exec-maven-plugin</code> in your Apache Maven configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
  &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.1.0&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;generate-k8s-descriptors&lt;/id&gt;
      &lt;phase&gt;prepare-package&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;java&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;stopUnresponsiveDaemonThreads&gt;false&lt;/stopUnresponsiveDaemonThreads&gt;
        &lt;cleanupDaemonThreads&gt;false&lt;/cleanupDaemonThreads&gt;
        &lt;mainClass&gt;org.superbiz.MyGenerator&lt;/mainClass&gt;
        &lt;arguments&gt;
          &lt;argument&gt;${project.build.directory}/k8s-descriptors&lt;/argument&gt;
        &lt;/arguments&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you run <code>mvn prepare-package</code> you will get your descriptors dumped in <code>target/k8s-descriptors</code> folder.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jshell_setup">JShell setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use this project with JShell, you just need to ensure the JShell classpath is correct when executing your script.
As of today, you must ensure it contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(optional for some setup but recommended) a JSON-P API and implementation,</p>
</li>
<li>
<p>(optional) a JSON-B API and implementation,</p>
</li>
<li>
<p>The <code>kubernetes-java-xxx</code> version you need,</p>
</li>
<li>
<p>(optional) <code>bundlebee-java</code> if you use it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is how to run a custom JShell script (note it assumes it runs on Linux and the jar were downloaded in current folder):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jshell \
  --class-path \
  geronimo-json_1.1_spec-1.4-jakarta.jar:johnzon-core-1.2.18-jakarta.jar:kubernetes-java-1.24.3-1.0.0.jar \
  my-script.jsh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you just need to write your script almost as in plain java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.yupiik.kubernetes.bindings.v1_24_3.v1.*; // <b class="conum">(1)</b>

{ // <b class="conum">(2)</b>
    final var output = Files.createDirectories(Path.of("target/k8s-descriptors"));

    final var deployment = new Deployment()
        .spec(new DeploymentSpec()
        /* ... */);

    Files.writeString(
       output.resolve("my-deployment.json"),
        deployment.asJson());
}

/exit // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Import the classes you need (here we use a wildcard import on the model because it is safe for our script but you can use explicit imports),</p>
</li>
<li>
<p>A small trick to write a readable script is to enable multiline snippet by wrapping the code in a block (rest of the code is similar to previous ones),</p>
</li>
<li>
<p>Finally when finished we exit JShell.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jbang_setup">JBang Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.jbang.dev/">JBang</a> can also be used to generate your descriptors.
Here is a script directly runnable with one of these runner:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From Maven/Gradle</p>
</li>
<li>
<p>From the command line if you installed <code>jbang</code> (either making your script executable - <code>///usr/bin/env jbang "$0" "$@" ; exit $?</code> or using <code>jbang $script</code>),</p>
</li>
<li>
<p>From <code>jbang-actions</code> (Github Actions integration)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">descriptors.generator.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//DEPS org.apache.geronimo.specs:geronimo-json_1.1_spec:1.4:jakarta
//DEPS org.apache.johnzon:johnzon-core:1.2.18:jakarta
//DEPS io.yupiik.kubernetes:kubernetes-java-1.24.3:1.0-SNAPSHOT

import io.yupiik.kubernetes.bindings.v1_24_3.v1.*;
import java.io.*;
import java.nio.file.*;

class Generator {
    public static void main(final String... args) throws IOException {
        final var output = Files.createDirectories(Path.of("target/k8s-descriptors"));

        final var deployment = new Deployment()
                .spec(new DeploymentSpec()
                    /*...*/);

        Files.writeString(
                output.resolve("my-deployment.json"),
                deployment.asJson());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is pretty much the same script than before but we handled the classpath thanks to <code>//DEPS</code> directive which can be convenient if you are already using JBang.</p>
</div>
<div class="paragraph">
<p>To set it with Github Actions use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">on: [push]

jobs:
  jbang:
    runs-on: ubuntu-20.04
    name: Generate descriptors
    steps:
    - name: checkout
      uses: actions/checkout@v3
    - uses: actions/cache@v3
      with:
        path: /root/.jbang
        key: $-jbang-$
        restore-keys: |
            $-jbang-
    - name: jbang
      uses: jbangdev/jbang-action@v0.97.0
      with:
        script: descriptors.generator.java
      env:
        JBANG_REPO: /root/.jbang/repository</code></pre>
</div>
</div>
</div>
</div>
                
            </div>
        </div>
    <div class="page-navigation-right">
        <h3>Navigation</h3>
        <nav class="generated-nav-menu"></nav>
    </div>
    </div>
    <hr />
    <footer class="footer pb-5">
	    <div class="footer-bottom text-center">
		    <ul class="social-list list-unstyled">
                <li class="list-inline-item"><a href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
	        </ul>
            <small class="copyright">Yupiik &copy;</small> | <a href="https://www.yupiik.com/terms-of-service/">Terms of service</a> | <a href="https://www.yupiik.com/privacy-policy/">Privacy policy</a>
	    </div>
    </footer>

    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">Search</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form onsubmit="return false;" class="form-inline">
          <div class="form-group">
            <label for="searchInput"><b>Search: </b></label>
            <input class="form-control" id="searchInput" placeholder="Enter search text and hit enter...">
          </div>
        </form>
        <div class="search-hits"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js" integrity="sha512-8qmis31OQi6hIRgvkht0s6mCOittjMa9GMqtK9hes5iEQBQE/Ca6yGE5FsW36vyipGoWQswBj/QBm2JR086Rkw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/highlight.min.js" integrity="sha512-d00ajEME7cZhepRqSIVsQVGDJBdZlfHyQLNC6tZXYKTG7iwcF8nhlFuppanz8hYgXr8VvlfKh4gLC25ud3c90A==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/json.min.js" integrity="sha512-37sW1XqaJmseHAGNg4N4Y01u6g2do6LZL8tsziiL5CMXGy04Th65OXROw2jeDeXLo5+4Fsx7pmhEJJw77htBFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/dockerfile.min.js" integrity="sha512-eRNl3ty7GOJPBN53nxLgtSSj2rkYj5/W0Vg0MFQBw8xAoILeT6byOogENHHCRRvHil4pKQ/HbgeJ5DOwQK3SJA==" crossorigin="anonymous"></script>
    <script>if (!(window.minisite || {}).skipHighlightJs) { hljs.highlightAll(); }</script>
    <script src="http://localhost:4200/js/minisite.js?v=1.0-SNAPSHOT"></script>
    <script>$('.page-content-body').generatedNavMenu();</script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.3/fuse.min.js" integrity="sha512-neoBxVNv0UMXjoilAYGxfWrSsW6iAVclx7vQKdPJ9Peet1bM5YQjU0aIB8LtH8iNPa+pAyMZprBBw2ZQ/Q1LjQ==" crossorigin="anonymous"></script>

</body>
</html>
